<!DOCTYPE html>
<html>
<head>
    <title>Boston 311 data</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <input type="text" id="search" placeholder="Search">
    <table id="results">
        <thead>
            <!-- Column headers will be added here by JavaScript -->
        </thead>
        <tbody>
            <!-- Table data will be added here by JavaScript -->
        </tbody>
    </table>

    <script>
        $(document).ready(function(){
            $.get('boston311.php', function(data) {
                let records = JSON.parse(data);

                excluded_columns = ['survival_time_hours','survival_time', 'submittedphoto', 'closedphoto', 'closure_reason'];
                // Add table headers based on the keys from the first record
                let headersHtml = '<tr>';
                for (let key in records[0]) {
                    if (!excluded_columns.includes(key)) {
                        headersHtml += '<th>' + key + '</th>';
                    }
                }
                headersHtml += '</tr>';
                $('#results thead').append(headersHtml);

                // Add table data
                records.forEach(function(record) {
                    let recordHtml = '<tr>';
                    for (let key in record) {
                        if (key == "case_enquiry_id") {
                            recordHtml += '<td><a href="https://311.boston.gov/reports/'+ record[key] +'">' + record[key] + '</a></td>';
                        }
                        else if (!excluded_columns.includes(key)) {
                            recordHtml += '<td>' + record[key] + '</td>';
                        }
                    }
                    recordHtml += '</tr>';
                    $('#results tbody').append(recordHtml);
                });
            });

            $('#search').on('keyup', function() {
                var value = $(this).val().toLowerCase();
                $("#results tbody tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>
</body>
</html>
